<app>
    <router base={base}>
        <navbar/>
        <div class="row" style="margin-left: auto; margin-right: auto;">
            <div class="col-2 position-fixed" style="padding-left: 0">
                <leftbar/>
            </div>
            <div class="col offset-2 pt-3">
                <route path="#/infos">
                    <infoplus contenu={ state.global }/>
                    <tablecountry contenu={ state.pays }/>
                </route>
                <route path="#/infos/(.*)">
                    <graphcountry contenu={ state.country }/>
                </route>
                <route path="#/map(.*)">
                    <mapchart contenu="{state.codepays}"/>
                </route>

            </div>
        </div>
    </router>

    <script>
        const loc = window.location
        export default {
            state: {
                global: null,
                pays: null,
                country: null,
                codepays: null
            },
            base: `${loc.protocol}//${loc.host}${loc.pathname ? loc.pathname : ''}`,
            onBeforeMount(props, state) {
                state.global = ({
                    date: "NULL",
                })
                state.pays = ({
                    listpays: "NULL",
                })
                state.country = ({
                    data: "NULL",
                })
                state.codepays = ({
                    countrieslist: "NULL",
                })
                //resetBase();
                if (!dbCovidExist()) {
                    createDBCovid()
                    console.log("Base de donnée créé !")
                } else if (diffTime()) {
                    updateDBCovid()
                    console.log("Base de donnée Update !")
                }
                console.log("Fini !")


            }, onMounted(props, state) {

                let globalStat = selectGlobal()
                let countriesStat = selectCountries()
                addEvoCountry("FR")
                printAll()

                state.global = ({
                    date: selectTime(),
                    covidedGlobal: formatInt(globalStat.TotalConfirmed),
                    deathGlobal: formatInt(globalStat.TotalDeaths),
                    healedGlobal: formatInt(globalStat.TotalRecovered),
                    covidedToday: formatInt(globalStat.NewConfirmed),
                    deathToday: formatInt(globalStat.NewDeaths),
                    healedToday: formatInt(globalStat.NewRecovered)
                })

                state.pays = ({
                    listpays: countriesStat
                })

                let datacountry=[{
                    "year": "1994",
                    "gueris": 1587,
                    "cas": 650,
                    "morts": 121
                }, {
                    "year": "1995",
                    "gueris": 1567,
                    "cas": 683,
                    "morts": 146
                }, {
                    "year": "1996",
                    "gueris": 1617,
                    "cas": 691,
                    "morts": 138
                }, {
                    "year": "1997",
                    "gueris": 1630,
                    "cas": 642,
                    "morts": 127
                }, {
                    "year": "1998",
                    "gueris": 1660,
                    "cas": 699,
                    "morts": 105
                }, {
                    "year": "1999",
                    "gueris": 1683,
                    "cas": 721,
                    "morts": 109
                }, {
                    "year": "2000",
                    "gueris": 1691,
                    "cas": 737,
                    "morts": 112
                }, {
                    "year": "2001",
                    "gueris": 1298,
                    "cas": 680,
                    "morts": 101
                }, {
                    "year": "2002",
                    "gueris": 1275,
                    "cas": 664,
                    "morts": 97
                }, {
                    "year": "2003",
                    "gueris": 1246,
                    "cas": 648,
                    "morts": 93
                }, {
                    "year": "2004",
                    "gueris": 1318,
                    "cas": 697,
                    "morts": 111
                }, {
                    "year": "2005",
                    "gueris": 1213,
                    "cas": 633,
                    "morts": 87
                }, {
                    "year": "2006",
                    "gueris": 1199,
                    "cas": 621,
                    "morts": 79
                }, {
                    "year": "2007",
                    "gueris": 1110,
                    "cas": 210,
                    "morts": 81
                }, {
                    "year": "2008",
                    "gueris": 1165,
                    "cas": 232,
                    "morts": 75
                }, {
                    "year": "2009",
                    "gueris": 1145,
                    "cas": 219,
                    "morts": 88
                }, {
                    "year": "2010",
                    "gueris": 1163,
                    "cas": 201,
                    "morts": 82
                }, {
                    "year": "2011",
                    "gueris": 1180,
                    "cas": 285,
                    "morts": 87
                }, {
                    "year": "2012",
                    "gueris": 1159,
                    "cas": 277,
                    "morts": 71
                }];

                state.country = ({
                    data: datacountry,
                    countrieslist: selectCountriesCode(countriesStat)
                })

                state.codepays = ({
                    countrieslist: selectCountriesCode(countriesStat)
                })
                this.update()
            }
        }
    </script>

</app>